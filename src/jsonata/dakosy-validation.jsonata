( /*  update error_0004 bugs   11-08-2025 */
        $IO3000 := [];
        $A1140 := [];
        $A1460 := ["1", "0"];

        $errorMap := {
            /*--------------------*/
            /*---INVALID----------*/
            /*--------------------*/
            "INVALID_0001": {
                "en": "IO Partner must not exceed 100 characters",
                "tr": "IO Partner 100 karakterden uzun olamaz"
            },
            "INVALID_0002": {
                "en": "IO Division 3 must not exceed 10 characters",
                "tr": "IO Division 3 10 karakterden uzun olamaz"
            },
            "INVALID_0003": {
                "en": "IO Reference must not exceed 35 characters",
                "tr": "IO Reference 35 karakterden uzun olamaz"
            },
            "INVALID_0004": {
                "en": "Object name must not exceed 35 characters",
                "tr": "Nesne adı 35 karakterden uzun olamaz"
            },
            "INVALID_0005": {
                "en": "Object alias must not exceed 35 characters",
                "tr": "Nesne takma adı 35 karakterden uzun olamaz"
            },
            "INVALID_0006": {
                "en": "Declaration type must not exceed 5 characters",
                "tr": "Beyanname türü 5 karakterden uzun olamaz"
            },
            "INVALID_0007": {
                "en": "Username must not exceed 70 characters",
                "tr": "Kullanıcı adı 70 karakterden uzun olamaz"
            },
            "INVALID_0008": {
                "en": "Reference number overlay must not exceed 35 characters",
                "tr": "Referans numarası 35 karakterden uzun olamaz"
            },
            "INVALID_0009": {
                "en": "Customs office code must not exceed 35 characters",
                "tr": "Gümrük müdürlüğü kodu 35 karakterden uzun olamaz"
            },
            "INVALID_0010": {
                "en": "Representation relationship code must be 1 character",
                "tr": "Temsil ilişkisi kodu 1 karakter olmalıdır"
            },
            "INVALID_0011": {
                "en": "Contact person name must not exceed 35 characters",
                "tr": "İletişim kişisi adı 35 karakterden uzun olamaz"
            },
            "INVALID_0012": {
                "en": "Contact person phone must not exceed 35 characters",
                "tr": "İletişim kişisi telefonu 35 karakterden uzun olamaz"
            },
            "INVALID_0013": {
                "en": "Contact person position must not exceed 35 characters",
                "tr": "İletişim kişisi pozisyonu 35 karakterden uzun olamaz"
            },
            "INVALID_0014": {
                "en": "Contact person email must not exceed 256 characters",
                "tr": "İletişim kişisi e-postası 256 karakterden uzun olamaz"
            },
            "INVALID_0015": {
                "en": "Procedure code must be 2 characters",
                "tr": "Prosedür kodu 2 karakter olmalıdır"
            },
            "INVALID_0016": {
                "en": "Departure country code must be 2 characters",
                "tr": "Kalkış ülke kodu 2 karakter olmalıdır"
            },
            "INVALID_0017": {
                "en": "Destination federal state must be 2 characters",
                "tr": "Hedef eyalet kodu 2 karakter olmalıdır"
            },
            "INVALID_0018": {
                "en": "Destination country code must be 2 characters",
                "tr": "Hedef ülke kodu 2 karakter olmalıdır"
            },
            "INVALID_0019": {
                "en": "Transport means identity must not exceed 30 characters",
                "tr": "Taşıma aracı kimliği 30 karakterden uzun olamaz"
            },
            "INVALID_0020": {
                "en": "Transport means nationality code must be 2 characters",
                "tr": "Taşıma aracı uyruk kodu 2 karakter olmalıdır"
            },
            "INVALID_0021": {
                "en": "Previous administrative reference type must not exceed 6 characters",
                "tr": "Önceki idari referans türü 6 karakterden uzun olamaz"
            },
            "INVALID_0022": {
                "en": "Previous administrative reference number must not exceed 28 characters",
                "tr": "Önceki idari referans numarası 28 karakterden uzun olamaz"
            },
            "INVALID_0023": {
                "en": "Document division must be 1 character",
                "tr": "Belge bölümü 1 karakter olmalıdır"
            },
            "INVALID_0024": {
                "en": "Address type must not exceed 10 characters",
                "tr": "Adres türü 10 karakterden uzun olamaz"
            },
            "INVALID_0025": {
                "en": "Address code must not exceed 10 characters",
                "tr": "Adres kodu 10 karakterden uzun olamaz"
            },
            "INVALID_0026": {
                "en": "Participant EORI must not exceed 17 characters",
                "tr": "Katılımcı EORI 17 karakterden uzun olamaz"
            },
            "INVALID_0027": {
                "en": "Participant subsidiary number must not exceed 4 characters",
                "tr": "Katılımcı bağlı kuruluş numarası 4 karakterden uzun olamaz"
            },
            "INVALID_0028": {
                "en": "Company name must not exceed 120 characters",
                "tr": "Şirket adı 120 karakterden uzun olamaz"
            },
            "INVALID_0029": {
                "en": "Street and number must not exceed 35 characters",
                "tr": "Sokak ve numara 35 karakterden uzun olamaz"
            },
            "INVALID_0030": {
                "en": "District must not exceed 35 characters",
                "tr": "İlçe 35 karakterden uzun olamaz"
            },
            "INVALID_0031": {
                "en": "Country code must not exceed 3 characters",
                "tr": "Ülke kodu 3 karakterden uzun olamaz"
            },
            "INVALID_0032": {
                "en": "Postal code must not exceed 9 characters",
                "tr": "Posta kodu 9 karakterden uzun olamaz"
            },
            "INVALID_0033": {
                "en": "City must not exceed 35 characters",
                "tr": "Şehir 35 karakterden uzun olamaz"
            },
            "INVALID_0034": {
                "en": "Declarant is consignee flag must be boolean",
                "tr": "Beyan eden alıcıdır alanı boolean olmalıdır"
            },
            "INVALID_0035": {
                "en": "Input tax deduction flag must be boolean",
                "tr": "KDV indirimi alanı boolean olmalıdır"
            },
            "INVALID_0038": {
                "en": "Invoice commodity code must not exceed 11 characters at invoice {{1}} item {{2}}",
                "tr": "Fatura eşya kodu 11 karakterden uzun olamaz, fatura {{1}} kalem {{2}}"
            },
            "INVALID_0039": {
                "en": "Declaration commodity code must not exceed 11 characters at item {{1}}",
                "tr": "Beyanname eşya kodu 11 karakterden uzun olamaz, kalem {{1}}"
            },
            "INVALID_0040": {
                "tr": "CMR tarihi hatalı, varsayılan tarih kullanıldı.",
                "en": "CMR date is invalid, default date is used."
            },
            "INVALID_0041": {
                "tr": "ATR tarihi hatalı, varsayılan tarih kullanıldı.",
                "en": "ATR date is invalid, default date is used."
            },
            "INVALID_0042": {
                "en": "Commercial invoice commodity code must not exceed 11 characters at invoice {{1}} item {{2}}",
                "tr": "Ticari fatura eşya kodu 11 karakterden uzun olamaz, fatura {{1}} kalem {{2}}"
            },
            "INVALID_0043": {
                "en": "Commercial invoice date is invalid, default date is used. Invoice NO: {{1}}",
                "tr": "Ticari fatura tarihi hatalı, varsayılan tarih kullanıldı. Fatura NO: {{1}}"
            },
            "INVALID_0044": {
                "en": "FTZ shipment date is invalid",
                "tr": "FTZ sevkiyat tarihi hatalı"
            },
            "INVALID_0045": {
                "en": "FTZ commodity code must not exceed 11 characters at position {{1}}",
                "tr": "FTZ eşya kodu 11 karakterden uzun olamaz, pozisyon {{1}}"
            },
            /*--------------------*/
            /*---MISSING----------*/
            /*--------------------*/
            "MISSING_0002": {
                "en": "IO Partner is required",
                "tr": "IO Partner zorunludur"
            },
            "MISSING_0003": {
                "en": "IO Reference is required",
                "tr": "IO Reference zorunludur"
            },
            "MISSING_0005": {
                "en": "Object name is required",
                "tr": "Nesne adı zorunludur"
            },
            "MISSING_0006": {
                "en": "Username is required",
                "tr": "Kullanıcı adı zorunludur"
            },
            "MISSING_0007": {
                "tr": "Fatura tarihi eksik, varsayılan tarih kullanıldı. Fatura NO: {{1}}",
                "en": "Invoice date is missing or invalid, default date is used. Invoice NO: {{1}}"
            },
            "MISSING_0008": {
                "tr": "CMR tarihi eksik, varsayılan tarih kullanıldı.",
                "en": "CMR date is missing, default date is used."
            },
           "MISSING_0009": {
                "tr": "ATR tarihi eksik, varsayılan tarih kullanıldı.",
                "en": "ATR date is missing, default date is used."
            },
            "MISSING_0010": {
                "en": "Total gross weight in TR Export Declaration could not retrieved.",
                "tr": "Beyanname toplam brüt ağırlık alınamadı."
            },
            "MISSING_0011": {
                "en": "Total net weight in TR Export Declaration could not retrieved.",
                "tr": "Beyanname toplam net ağırlık alınamadı."
            },
            "MISSING_0012": {
                "en": "Item gross weight in TR Export Declaration could not retrieved at item {{1}}.",
                "tr": "Beyanname kalem brüt ağırlık alınamadı, kalem {{1}}."
            },
            "MISSING_0013": {
                "en": "Item net weight in TR Export Declaration could not retrieved at item {{1}}.",
                "tr": "Beyanname kalem net ağırlık alınamadı, kalem {{1}}."
            },
            "MISSING_0014": {
                "en": "Item statistical value in TR Export Declaration could not retrieved at item {{1}}.",
                "tr": "Beyanname kalem istatistiki değer alınamadı, kalem {{1}}."
            },
            "MISSING_0015": {
                "en": "Item quantity in TR Export Declaration could not retrieved at item {{1}}.",
                "tr": "Beyanname kalem miktar alınamadı, kalem {{1}}."
            },
            "MISSING_0016": {
                "en": "Item value in TR Export Declaration could not retrieved at item {{1}}.",
                "tr": "Beyanname kalem değer alınamadı, kalem {{1}}."
            },
            "MISSING_0017": {
                "en": "Commercial invoice date is missing, default date is used. Invoice NO: {{1}}",
                "tr": "Ticari fatura tarihi eksik, varsayılan tarih kullanıldı. Fatura NO: {{1}}"
            },
            "MISSING_0018": {
                "en": "FTZ shipment ID is missing",
                "tr": "FTZ sevkiyat ID eksik"
            },
            "MISSING_0019": {
                "en": "FTZ shipment date is missing",
                "tr": "FTZ sevkiyat tarihi eksik"
            },
            "MISSING_0020": {
                "en": "FTZ total gross weight could not be retrieved",
                "tr": "FTZ toplam brüt ağırlık alınamadı"
            },
            "MISSING_0021": {
                "en": "FTZ item quantity could not be retrieved at position {{1}}",
                "tr": "FTZ kalem miktar alınamadı, pozisyon {{1}}"
            },
            "MISSING_0022": {
                "en": "FTZ item value could not be retrieved at position {{1}}",
                "tr": "FTZ kalem değer alınamadı, pozisyon {{1}}"
            },
            /*--------------------*/
            /*---ERROR------------*/
            /*--------------------*/
            "ERROR_0007": {
                "en": "Dispatch country and destination country cannot be the same",
                "tr": "Gönderim ülkesi ve varış ülkesi aynı olamaz"
            }
        };

        /*
        -------------------
        Assign functions
        -------------------
        */
        $_isValidDate($date);
        $_isValidDateWithoutTime($date);

        $isDeclarationExist := $exists($.tr_export_declaration) and $type($.tr_export_declaration) = "object";
        $isInvoiceExist := $exists($.invoice) and $type($.invoice) = "array" and $count($.invoice) > 0;
        $isCmrExist := $exists($.cmr) and $type($.cmr) = "object";
        $isAtrExist := $exists($.atr) and $type($.atr) = "object";
        $isTransitDeclarationExist := $exists($.transit_declaration) and $type($.transit_declaration) = "object";
        $isCombineItemsExist := $exists($.combine_items) and $type($.combine_items) = "object" and $count($.combine_items.items) > 0;
        $isCombineItemsCreatedFromInvoice := $isCombineItemsExist and $.combine_items.items[0].reference_item_details[0].source = 'invoice';
        $isCommercialInvoiceExist := $exists($.commercial_invoice) and $type($.commercial_invoice) = "array";
        $isFtzExist := $exists($.ftz) and $type($.ftz) = "object" and $.ftz.shipment.id ?? null;


        $atoi := function($data) {$type($data) = "string" ? $round($number($replace($data, ",", ".")), 2) : $data};

        $isExist := function($data, $errorMessage) {$data ? null : $errorMessage};

        $max := function($data, $value, $errorMessage) { $data and $type($data) = "string" ? $length($data) <= $value ? null : $errorMessage : null };
        $min := function($data, $value, $errorMessage) { $data and $type($data) = "string" ?  $length($data) >= $value ? null : $errorMessage : null };
        $eq := function($data, $value, $errorMessage) { $type($data) = "string" ? $length($data) = $value ? null : $errorMessage : null };
        $neq := function($data, $value, $errorMessage) { $type($data) = "string" ? $length($data) != $value ? null : $errorMessage : null };

        $between := function($data, $min, $max, $errorMessage) { $type($data) = "string" ? $length($data) > $min and $length($data) <= $max ? null : $errorMessage : null };
        $betweene := function($data, $min, $max, $errorMessage) { $type($data) = "string" ? $length($data) >= $min and $length($data) <= $max ? null : $errorMessage : null };
        $nbetween := function($data, $min, $max, $errorMessage) { $type($data) = "string" ? $length($data) < $min or $length($data) > $max ? null : $errorMessage : null };

        $in := function($data, $values, $errorMessage) {$type($data) = "string" and $data in $values ? null : $errorMessage };
        $nin := function($data, $values, $errorMessage) { $data in $values ? $errorMessage : null };
        $like := function($data, $pattern, $errorMessage) { $match($data, $pattern) ? null : $errorMessage };
        $nlike := function($data, $pattern, $errorMessage) { $match($data, $pattern) ? $errorMessage : null };
        $startsWith := function($data, $prefix, $errorMessage) { $substring($data, 0, $length($prefix)) = $prefix ? null : $errorMessage };
        $endsWith := function($data, $suffix, $errorMessage) { $substring($data, $length($data) - $length($suffix)) = $suffix ? null : $errorMessage };
        $strContains := function($data, $substring, $errorMessage) { $contains($data, $substring) ? null : $errorMessage };
        $nStrContains := function($data, $substring, $errorMessage) { $contains($data, $substring) ? $errorMessage : null };
        $isNotNull := function($data, $errorMessage) { $data != null ? null : $errorMessage };
        $isNull := function($data, $errorMessage) { $data = null ? null : $errorMessage };
        $isNotEmpty := function($data, $errorMessage) { $data != null and $data != '' ? null : $errorMessage };
        $isEmpty := function($data, $errorMessage) { $data = null or $data = '' ? null : $errorMessage };

        $isBoolean := function($data, $errorMessage) { $data = true or $data = false ? null : $errorMessage };
        $isNumber := function($data, $errorMessage) { $type($data) = "number" ? null : $errorMessage };
        $isDateFormat := function($data, $errorMessage) {
            $match($data) ? null : $errorMessage
        };

        $formatErrorMessageObject := function($errorObject) {(
            $errorCode := $errorObject.code;
            $errorMessageObject := $lookup($errorMap, $errorCode);

            $message := $lookup($errorMessageObject, "en");

            $formattedMessage := $reduce($errorObject.args, function($acc, $arg, $index) {
                $replace($acc, "{{" & ($index + 1) & "}}", $string($arg))
            }, $message);

            $pathTmp := $reduce($errorObject.path, function($acc, $v, $i) {
                $isNumber($v, "") = null ?
                    ($i = 0 ? "[" & $v & "]" : $acc & "[" & $v & "]") : ($i = 0 ? $v : $acc & "." & $v)
            }, "");

            {
                "code": $errorCode,
                "message": $formattedMessage ? $formattedMessage : $message,
                "path": $pathTmp ? $pathTmp : "unknown"
            }
        )};

        $formatErrorMessageString := function($errorCode) {(
            $list := $split($errorCode, "&");
            $errorMessage := $lookup($errorMap, $list[0]);

            $message := $lookup($errorMessage, "en");

            {
                "code": $list[0],
                "message": $message ? $message : $list[0],
                "place": 1
            }
        )};

        $formatErrorMessage := function($errorCode) {
            $type($errorCode) = "object" ? $formatErrorMessageObject($errorCode) : $formatErrorMessageString($errorCode)
        };

        $customAppend := function($data) {(
            $data = $type($data) = "array" ? $data : $type($data) = "object" ? [$data] : [];

            $response := $reduce($data, $append)
        )};

        /* --- */
        /* --- */
        /* --- */
        /* --- */
        /*Additional ---*/
        /* --- */
        /* --- */
        /* --- */
        /* --- */
        $additionalWarningFirst := $filter([
            $max($.additional_data.transaction.ioPartner, 100, {"code": "INVALID_0001", "path": ["additional_data", "transaction", "ioPartner"], "args": []}), /*IOPartner*/
            $max($.additional_data.transaction.ioDivision3, 10, {"code": "INVALID_0002", "path": ["additional_data", "transaction", "ioDivision3"], "args": []}), /*IODivision3*/
            $max($.additional_data.transaction.ioReference, 35, {"code": "INVALID_0003", "path": ["additional_data", "transaction", "ioReference"], "args": []}),

            $map($.additional_data.declaration, function($v, $i) {
                [
                    $max($v.objectIdentification.objectName, 35, {"code": "INVALID_0004", "path": ["additional_data", "declaration", $i, "objectIdentification", "objectName"], "args": [$i + 1]}),
                    $max($v.objectIdentification.objectAlias, 35, {"code": "INVALID_0005", "path": ["additional_data", "declaration", $i, "objectIdentification", "objectAlias"], "args": [$i + 1]}), /*ObjektAlias*/
                    $max($v.objectIdentification.declarationType, 5, {"code": "INVALID_0006", "path": ["additional_data", "declaration", $i, "objectIdentification", "declarationType"], "args": [$i + 1]}), /*AnmeldungArt*/
                    $max($v.objectIdentification.username, 70, {"code": "INVALID_0007", "path": ["additional_data", "declaration", $i, "objectIdentification", "username"], "args": [$i + 1]}),
                    $max($v.objectIdentification.referenceNumberOverlay, 35, {"code": "INVALID_0008", "path": ["additional_data", "declaration", $i, "objectIdentification", "referenceNumberOverlay"], "args": [$i + 1]}), /*BezugsnummerVorblendung*/

                    $max($v.headerData.addressedCustomsOffice, 35, {"code": "INVALID_0009", "path": ["additional_data", "declaration", $i, "headerData", "addressedCustomsOffice"], "args": [$i + 1]}), /*AdressierteZollstelle*/
                    $max($v.headerData.representationRelationshipCode, 1, {"code": "INVALID_0010", "path": ["additional_data", "declaration", $i, "headerData", "representationRelationshipCode"], "args": [$i + 1]}), /*VertretungsverhaeltnisCode*/

                    $max($v.headerData.agentContact.contactPersonName, 35, {"code": "INVALID_0011", "path": ["additional_data", "declaration", $i, "headerData", "agentContact", "contactPersonName"], "args": [$i + 1]}), /*NameAnmeldenderBearbeiter*/
                    $max($v.headerData.agentContact.contactPersonPhoneNumber, 35, {"code": "INVALID_0012", "path": ["additional_data", "declaration", $i, "headerData", "agentContact", "contactPersonPhoneNumber"], "args": [$i + 1]}), /*TelefonnummerAnmeldenderBearbeiter*/
                    $max($v.headerData.agentContact.contactPersonPosition, 35, {"code": "INVALID_0013", "path": ["additional_data", "declaration", $i, "headerData", "agentContact", "contactPersonPosition"], "args": [$i + 1]}), /*StellungAnmeldenderBearbeiter*/
                    $max($v.headerData.agentContact.contactPersonEmail, 256, {"code": "INVALID_0014", "path": ["additional_data", "declaration", $i, "headerData", "agentContact", "contactPersonEmail"], "args": [$i + 1]}), /*EmailAdresseAnmeldenderBearbeiter*/

                    $max($v.headerData.procedureCodeRequested, 2, {"code": "INVALID_0015", "path": ["additional_data", "declaration", $i, "headerData", "procedureCodeRequested"], "args": [$i + 1]}), /*FiskalvertretungKz*/
                    $max($v.headerData.departureCountry, 2, {"code": "INVALID_0016", "path": ["additional_data", "declaration", $i, "headerData", "departureCountry"], "args": [$i + 1]}), /*ZollrechtlicherStatus*/
                    $max($v.headerData.destinationFederalState, 2, {"code": "INVALID_0017", "path": ["additional_data", "declaration", $i, "headerData", "destinationFederalState"], "args": [$i + 1]}), /*Bestimmungsbundesland*/
                    $max($v.headerData.destinationCountry, 2, {"code": "INVALID_0018", "path": ["additional_data", "declaration", $i, "headerData", "destinationCountry"], "args": [$i + 1]}), /*Bestimmungsland*/
                    $max($v.headerData.transportMeansArrivalIdentity, 30, {"code": "INVALID_0019", "path": ["additional_data", "declaration", $i, "headerData", "transportMeansArrivalIdentity"], "args": [$i + 1]}), /*KennzeichenNameBefoerderungsmittelAnkunft*/
                    $max($v.headerData.transportMeansNationalityCode, 2, {"code": "INVALID_0020", "path": ["additional_data", "declaration", $i, "headerData", "transportMeansNationalityCode"], "args": [$i + 1]}), /*BefoerderungsmittelGrenzeStaatszugehoerigkeitCode*/
                    $max($v.headerData.previousAdministrativeReferenceType, 6, {"code": "INVALID_0021", "path": ["additional_data", "declaration", $i, "headerData", "previousAdministrativeReferenceType"], "args": [$i + 1]}), /*VorpapierArtCode*/
                    $max($v.headerData.previousAdministrativeReferenceNumber, 28, {"code": "INVALID_0022", "path": ["additional_data", "declaration", $i, "headerData", "previousAdministrativeReferenceNumber"], "args": [$i + 1]}), /*VorpapierNr*/

                    /*Kostenart (dv1CostAllocation.costType)*/
                    /*Kosten (dv1CostAllocation.costs)*/
                    /*KostenWaehrung (dv1CostAllocation.currencyCode)*/

                    $max($v.headerData.base.documentDivision, 1, {"code": "INVALID_0023", "path": ["additional_data", "declaration", $i, "headerData", "base", "documentDivision"], "args": [$i]}),

                    $map($v.addresses, function($vv, $ii) {
                        [
                            $max($vv.addressType, 10, {"code": "INVALID_0024", "path": ["additional_data", "declaration", $i, "addresses", $ii, "addressType"], "args": [$i + 1, $ii + 1]}), /* "AdressTyp": $a.addressType, */
                            $max($vv.addressCode, 10, {"code": "INVALID_0025", "path": ["additional_data", "declaration", $i, "addresses", $ii, "addressCode"], "args": [$i + 1, $ii + 1]}), /* "AdressCode": "1", */
                            $max($vv.participantEORI, 17, {"code": "INVALID_0026", "path": ["additional_data", "declaration", $i, "addresses", $ii, "participantEORI"], "args": [$i + 1, $ii + 1]}), /* "TeilnehmerEORI": $a.participantEORI, */
                            $max($vv.participantSubsidiaryNumber, 4, {"code": "INVALID_0027", "path": ["additional_data", "declaration", $i, "addresses", $ii, "participantSubsidiaryNumber"], "args": [$i + 1, $ii + 1]}),/* "TeilnehmerNLNR": $a.participantSubsidiaryNumber, */
                            $max($vv.companyName, 120, {"code": "INVALID_0028", "path": ["additional_data", "declaration", $i, "addresses", $ii, "companyName"], "args": [$i + 1, $ii + 1]}),/* "NameFirma": $a.companyName, */
                            $max($vv.streetAndNumber, 35, {"code": "INVALID_0029", "path": ["additional_data", "declaration", $i, "addresses", $ii, "streetAndNumber"], "args": [$i + 1, $ii + 1]}), /* "StrasseHausNr": $a.streetAndNumber, */
                            $max($vv.district, 35, {"code": "INVALID_0030", "path": ["additional_data", "declaration", $i, "addresses", $ii, "district"], "args": [$i + 1, $ii + 1]}), /* "Ortsteil": $a.district, */
                            $max($vv.countryCode, 3, {"code": "INVALID_0031", "path": ["additional_data", "declaration", $i, "addresses", $ii, "countryCode"], "args": [$i + 1, $ii + 1]}), /* "LandCode": $a.countryCode, */
                            $max($vv.postalCode, 9, {"code": "INVALID_0032", "path": ["additional_data", "declaration", $i, "addresses", $ii, "postalCode"], "args": [$i + 1, $ii + 1]}), /* "PLZ-S": $a.postalCode, */
                            $max($vv.city, 35, {"code": "INVALID_0033", "path": ["additional_data", "declaration", $i, "addresses", $ii, "city"], "args": [$i + 1, $ii + 1]}) /* "Ort-S": $a.city */
                        ]
                    }) ~> $customAppend()
                ]
            }) ~> $customAppend()
        ], function($v) { $v != null });
        $additionalErrorsFirst := $filter([
            $isExist($.additional_data.transaction.ioPartner, {"code": "MISSING_0002", "path": ["additional_data", "transaction", "ioPartner"], "args": []}), /*IOPartner*/
            $isExist($.additional_data.transaction.ioReference, {"code": "MISSING_0003", "path": ["additional_data", "transaction", "ioReference"], "args": []}), /*IOReferenz*/

            $map($.additional_data.declaration, function($v, $i) {
                [
                    $isExist($v.objectIdentification.objectName, {"code": "MISSING_0005", "path": ["additional_data", "declaration", $i, "objectIdentification", "objectName"], "args": [$i + 1]}), /*ObjektName*/
                    $isExist($v.objectIdentification.username, {"code": "MISSING_0006", "path": ["additional_data", "declaration", $i, "objectIdentification", "username"], "args": [$i + 1]}), /*Bearbeiter*/

                    $isBoolean($v.headerData.declarantIsConsignee, {"code": "INVALID_0034", "path": ["additional_data", "declaration", $i, "headerData", "declarantIsConsignee"], "args": [$i + 1]}), /*AnmelderIstEmpfaenger*/
                    $isBoolean($v.headerData.inputTaxDeduction, {"code": "INVALID_0035", "path": ["additional_data", "declaration", $i, "headerData", "inputTaxDeduction"], "args": [$i + 1]}) /*Vorsteuerabzug*/
                ]
            }) ~> $customAppend()
        ], function($v) { $v != null });
        $additionalErrors := $count($additionalErrorsFirst) ? $map($additionalErrorsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];
        $additionalWarnings := $count($additionalWarningFirst) ? $map($additionalWarningFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];

        /* --- */
        /* --- */
        /* --- */
        /* --- */
        /*Invoice ---*/
        /* --- */
        /* --- */
        /* --- */
        /* --- */
        $invoiceErrorsFirst := $isInvoiceExist and $type(invoice) = "array" ?
            $filter([
                $map(invoice, function($v, $i) {
                    [
                        $map($v.items, function($vv, $ii) {
                            [
                                /* Commodity Code Validations*/
                                /*$max($vv.invoice_item_commodity_code, 11, {"code": "INVALID_0038", "path": ["invoice", $i, "items", $ii, "invoice_item_commodity_code"], "args": [$ii]})*/
                            ]
                        }) ~> $customAppend()
                    ]
                }) ~> $customAppend() 
            ], function($v) { $v != null })
        : [];
        $invoiceWarningFirst := $isInvoiceExist and $type(invoice) = "array" ?
            $filter([
                $map(invoice, function($v, $i) {
                    [
                        $_isValidDateWithoutTime($v.invoice_date) ? null : {"code": "MISSING_0007", "path": ["invoice", $i, "invoice_date"], "args": [$v.invoice_id]},
                        $map($v.items, function($vv, $ii) {
                            [
                                /* Commodity Code Validations*/
                                $max($vv.invoice_item_commodity_code, 11, {"code": "INVALID_0038", "path": ["invoice", $i, "items", $ii, "invoice_item_commodity_code"], "args": [$i + 1, $ii + 1]})
                            ]
                        }) ~> $customAppend()
                    ]
                }) ~> $customAppend() 
            ], function($v) { $v != null })
        : [];
        $invoiceErrors := $count($invoiceErrorsFirst) ? $map($invoiceErrorsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];
        $invoiceWarnings := $count($invoiceWarningFirst) ? $map($invoiceWarningFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];

        /* --- */
        /* --- */
        /* --- */
        /* --- */
        /*Declaration ---*/
        /* --- */
        /* --- */
        /* --- */
        /* --- */
        $declarationErrorsFirst := $isDeclarationExist and $type(tr_export_declaration) = "object" ?
            $filter([
                $map(tr_export_declaration.items, function($v, $i) {
                    [
                            /* Commodity Code Validations*/
                            /*$max($v.commodity_code, 11, {"code": "INVALID_0039", "path": ["tr_export_declaration", "items", $i, "commodity_code"], "args": [$i]})*/
                    ]
                }) ~> $customAppend() 
            ], function($v) { $v != null })
        : [];
        $declarationWarningsFirst := $isDeclarationExist and $type(tr_export_declaration) = "object" ?
            $filter([
                /* Total weight validations */
                $isNotNull($.tr_export_declaration.total_gross_weight, {"code": "MISSING_0010", "path": ["tr_export_declaration", "total_gross_weight"], "args": []}),
                $isNotNull($.tr_export_declaration.total_net_weight, {"code": "MISSING_0011", "path": ["tr_export_declaration", "total_net_weight"], "args": []}),
                $map(tr_export_declaration.items, function($v, $i) {
                    [
                            /* Commodity Code Validations*/
                            $max($v.commodity_code, 11, {"code": "INVALID_0039", "path": ["tr_export_declaration", "items", $i, "commodity_code"], "args": [$i + 1]}),
                            /* Item weight validations */
                            $isNotNull($v.gross_weight, {"code": "MISSING_0012", "path": ["tr_export_declaration", "items", $i, "gross_weight"], "args": [$i + 1]}),
                            $isNotNull($v.net_weight, {"code": "MISSING_0013", "path": ["tr_export_declaration", "items", $i, "net_weight"], "args": [$i + 1]}),
                            $isNotNull($v.statistical_value, {"code": "MISSING_0014", "path": ["tr_export_declaration", "items", $i, "statistical_value"], "args": [$i + 1]}),
                            $isNotNull($v.quantity, {"code": "MISSING_0015", "path": ["tr_export_declaration", "items", $i, "quantity"], "args": [$i + 1]}),
                            $isNotNull($v.item_value, {"code": "MISSING_0016", "path": ["tr_export_declaration", "items", $i, "item_value"], "args": [$i + 1]})
                    ]
                }) ~> $customAppend() 
            ], function($v) { $v != null })
        : [];
        $declarationErrors := $count($declarationErrorsFirst) ? $map($declarationErrorsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];
        $declarationWarnings := $count($declarationWarningsFirst) ? $map($declarationWarningsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];

        /* --- */
        /* --- */
        /* --- */
        /* --- */
        /*CMR ---*/
        /* --- */
        /* --- */
        /* --- */
        /* --- */
        $cmrErrorsFirst := $isCmrExist and $type(cmr) = "object" ?
            $filter([
            ], function($v) { $v != null })
        : [];
        $cmrWarningsFirst := $isCmrExist and $type(cmr) = "object" ?
            $filter([
                $_isValidDateWithoutTime($.cmr.date) ? null : {"code": "INVALID_0040", "path": ["cmr", "date"], "args": []}
            ], function($v) { $v != null })
        : [];
        $cmrErrors := $count($cmrErrorsFirst) ? $map($cmrErrorsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];
        $cmrWarnings := $count($cmrWarningsFirst) ? $map($cmrWarningsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];

        /* --- */
        /* --- */
        /* --- */
        /* --- */
        /*ATR ---*/
        /* --- */
        /* --- */
        /* --- */
        /* --- */
        $atrErrorsFirst := $isAtrExist and $type(atr) = "object" ?
            $filter([
            ], function($v) { $v != null })
        : [];
        $atrWarningsFirst := $isAtrExist and $type(atr) = "object" ?
            $filter([
                $_isValidDateWithoutTime($.atr.date) ? null : {"code": "INVALID_0041", "path": ["atr", "date"], "args": []}
            ], function($v) { $v != null })
        : [];
        $atrErrors := $count($atrErrorsFirst) ? $map($atrErrorsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];
        $atrWarnings := $count($atrWarningsFirst) ? $map($atrWarningsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];



        /* --- */
        /* --- */
        /* --- */
        /* --- */
        /*Commercial Invoice ---*/
        /* --- */
        /* --- */
        /* --- */
        /* --- */
        $commercialInvoiceErrorsFirst := $isCommercialInvoiceExist and $type(commercial_invoice) = "array" ?
            $filter([
                $map(commercial_invoice, function($v, $i) {
                    [
                        $map($v.items, function($vv, $ii) {
                            [
                                /* Commodity Code Validations*/
                            ]
                        }) ~> $customAppend()
                    ]
                }) ~> $customAppend() 
            ], function($v) { $v != null })
        : [];
        $commercialInvoiceWarningFirst := $isCommercialInvoiceExist and $type(commercial_invoice) = "array" ?
            $filter([
                $map(commercial_invoice, function($v, $i) {
                    [
                        $_isValidDateWithoutTime($v.invoice_date) ? null : {"code": "MISSING_0017", "path": ["commercial_invoice", $i, "invoice_date"], "args": [$v.invoice_id]},
                        $map($v.items, function($vv, $ii) {
                            [
                                /* Commodity Code Validations*/
                                $max($vv.invoice_item_commodity_code, 11, {"code": "INVALID_0042", "path": ["commercial_invoice", $i, "items", $ii, "invoice_item_commodity_code"], "args": [$i + 1, $ii + 1]})
                            ]
                        }) ~> $customAppend()
                    ]
                }) ~> $customAppend() 
            ], function($v) { $v != null })
        : [];
        $commercialInvoiceErrors := $count($commercialInvoiceErrorsFirst) ? $map($commercialInvoiceErrorsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];
        $commercialInvoiceWarnings := $count($commercialInvoiceWarningFirst) ? $map($commercialInvoiceWarningFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];

        /* --- */
        /* --- */
        /* --- */
        /* --- */
        /*FTZ ---*/
        /* --- */
        /* --- */
        /* --- */
        /* --- */
        $ftzErrorsFirst := $isFtzExist and $type(ftz) = "object" ?
            $filter([
                $map(ftz.shipment.positions, function($v, $i) {
                    [
                            /* Commodity Code Validations*/
                    ]
                }) ~> $customAppend() 
            ], function($v) { $v != null })
        : [];
        $ftzWarningsFirst := $isFtzExist and $type(ftz) = "object" ?
            $filter([
                /* Shipment date validation */
                $_isValidDateWithoutTime($.ftz.shipment.date) ? null : {"code": "INVALID_0044", "path": ["ftz", "shipment", "date"], "args": []},
                /* Total weight validation */
                $isNotNull($.ftz.shipment.total_gross_weight, {"code": "MISSING_0020", "path": ["ftz", "shipment", "total_gross_weight"], "args": []}),
                $map(ftz.shipment.positions, function($v, $i) {
                    [
                            /* Commodity Code Validations*/
                            $max($v.commodity_code, 11, {"code": "INVALID_0045", "path": ["ftz", "shipment", "positions", $i, "commodity_code"], "args": [$i + 1]}),
                            /* Item validations */
                            $isNotNull($v.quantity, {"code": "MISSING_0021", "path": ["ftz", "shipment", "positions", $i, "quantity"], "args": [$i + 1]}),
                            $isNotNull($v.value, {"code": "MISSING_0022", "path": ["ftz", "shipment", "positions", $i, "value"], "args": [$i + 1]})
                    ]
                }) ~> $customAppend() 
            ], function($v) { $v != null })
        : [];
        $ftzErrors := $count($ftzErrorsFirst) ? $map($ftzErrorsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];
        $ftzWarnings := $count($ftzWarningsFirst) ? $map($ftzWarningsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];

        /* --- */
        /* --- */
        /* --- */
        /* --- */
        /*Global ---*/
        /* --- */
        /* --- */
        /* --- */
        /* --- */
        $dispatchDestinationCountriesSame := function() {(
            $dispatchCountry := $.dispatch_country ? $uppercase($.dispatch_country) : null;
            $destinationCountry := $.destination_country ? $uppercase($.destination_country) : null;

            $dispatchCountry and $destinationCountry and $dispatchCountry = $destinationCountry ?
              {"code": "ERROR_0007"}:  null;
        )};

        $globalErrorsFirst := $filter([
        ], function($v) { $v != null });
        $globalWarningsFirst := $filter([
            $dispatchDestinationCountriesSame()
        ], function($v) { $v != null });
        $globalErrors := $count($globalErrorsFirst) ? $map($globalErrorsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];
        $globalWarnings := $count($globalWarningsFirst) ? $map($globalWarningsFirst, function($error) {
            $formatErrorMessage($error)
        }) : [];


        {
            "additional_data": {
                "errors": $count($additionalErrors) = 1 ? [$additionalErrors] : $additionalErrors,
                "warnings": $count($additionalWarnings) = 1 ? [$additionalWarnings] : $additionalWarnings
            },
            "invoice": {
                "errors": $count($invoiceErrors) = 1 ? [$invoiceErrors] : $invoiceErrors,
                "warnings": $count($invoiceWarnings) = 1 ? [$invoiceWarnings] : $invoiceWarnings
            },
            "tr_export_declaration": {
                "errors": $count($declarationErrors) = 1 ? [$declarationErrors] : $declarationErrors,
                "warnings": $count($declarationWarnings) = 1 ? [$declarationWarnings] : $declarationWarnings
            },
            "cmr": {
                "errors": $count($cmrErrors) = 1 ? [$cmrErrors] : $cmrErrors,
                "warnings": $count($cmrWarnings) = 1 ? [$cmrWarnings] : $cmrWarnings
            },
            "atr": {
                "errors": $count($atrErrors) = 1 ? [$atrErrors] : $atrErrors,
                "warnings": $count($atrWarnings) = 1 ? [$atrWarnings] : $atrWarnings
            },
            "commercial_invoice": {
                "errors": $count($commercialInvoiceErrors) = 1 ? [$commercialInvoiceErrors] : $commercialInvoiceErrors,
                "warnings": $count($commercialInvoiceWarnings) = 1 ? [$commercialInvoiceWarnings] : $commercialInvoiceWarnings
            },
            "ftz": {
                "errors": $count($ftzErrors) = 1 ? [$ftzErrors] : $ftzErrors,
                "warnings": $count($ftzWarnings) = 1 ? [$ftzWarnings] : $ftzWarnings
            },
            "global": {
                "errors": $count($globalErrors) = 1 ? [$globalErrors] : $globalErrors,
                "warnings": $count($globalWarnings) = 1 ? [$globalWarnings] : $globalWarnings
            }
        }
    )